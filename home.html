<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inventaire magasin</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- jsPDF pour les bons d'achat -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- html2pdf pour les bons de pr√©paration -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <header class="app-header">
    <div class="header-left">
      <h1>Gestion de stock</h1>
      <span id="currentUser"></span>

      <div class="tabs">
        <button class="tab active" id="tab-articles">Articles</button>
        <button class="tab" id="tab-mouvements">Mouvements</button>
        <button class="tab" id="tab-reservations">R√©servations</button>
        <button class="tab" id="tab-preparations">Pr√©parations</button>
        <button class="tab" id="tab-affaires">Affaires</button>
      </div>
    </div>
    <div class="header-right">
      <div id="datetime"></div>

      <div class="user-menu">
        <button class="user-menu-toggle" id="userMenuToggle">
          <span id="userRoleLabel" class="role"></span>
          <span class="chevron">‚ñæ</span>
        </button>
        <div class="user-menu-dropdown" id="userMenuDropdown">
          <!-- Contenu rempli en JS selon r√¥le -->
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- Section Articles -->
    <section id="articlesSection">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="searchInput"
                 placeholder="Recherche (marque, r√©f, libell√©, cat√©gorie, emplacement)‚Ä¶">
        </div>

        <div class="actions">
          <button id="btnAdd">Ajouter un article</button>
          <button id="btnEdit" disabled>Modifier</button>
          <button id="btnDelete" disabled>Supprimer</button>
          <button id="btnImportArticles">Importer Excel</button>
          <input type="file" id="importFileInput" accept=".xlsx,.xls" style="display:none;">
        </div>
      </div>

      <div class="stock-footer">
        Valeur totale du stock : <span id="valeurStockTotal"></span>
        <button id="btnPrintStock" class="secondary" ; display:none;">
            Imprimer le stock
        </button>
      </div>

      <div class="inventory-table-wrapper">
        <table id="articlesTable">
          <thead>
            <tr>
              <th>Marque</th>
              <th>R√©f√©rence</th>
              <th>Libell√©</th>
              <th>Unit√©</th>
              <th>Cat√©gorie</th>
              <th>Emplacement</th>
              <th>Stock</th>
              <th>Stock dispo</th>
              <th>CUMP</th>
              <th>Valeur stock</th>
            </tr>
          </thead>
          <tbody id="articlesBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section Mouvements -->
    <section id="mouvementsSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="mouvSearchInput"
                 placeholder="Filtre (article, sens, affaire)‚Ä¶">
        </div>
        <div class="actions">
          <button id="btnMouvAdd">Cr√©er un mouvement</button>
        </div>
      </div>

      <div class="inventory-table-wrapper">
        <table id="mouvementsTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Sens</th>
              <th>Article</th>
              <th>Quantit√©</th>
              <th>Prix unitaire</th>
              <th>Code affaire</th>
            </tr>
          </thead>
          <tbody id="mouvementsBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section R√©servations -->
    <section id="reservationsSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="reservSearchInput"
                 placeholder="Filtre (affaire, article)‚Ä¶">
        </div>
        <div class="actions">
          <button id="btnNewReservation">Nouvelle r√©servation</button>
        </div>
      </div>

      <div class="inventory-table-wrapper">
        <table id="reservationsTable">
          <thead>
            <tr>
              <th>Affaire</th>
              <th>Article</th>
              <th>Quantit√©</th>
              <th>Date mise √† dispo</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody id="reservationsBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section Pr√©parations -->
    <section id="preparationsSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div>
          <label for="prepDateDebut">Du</label>
          <input type="date" id="prepDateDebut">
          <label for="prepDateFin">au</label>
          <input type="date" id="prepDateFin">
          <button id="btnPrepFiltrer">Filtrer</button>
        </div>
        <div class="actions">
          <button id="btnPrintPreparations">üñ®Ô∏è Imprimer les bons</button>
          <button id="btnValiderPreparation" disabled>‚úÖ Valider la pr√©paration</button>
        </div>
      </div>

      <div class="inventory-table-wrapper">
        <table id="preparationsTable">
          <thead>
            <tr>
              <th>Affaire</th>
              <th>Article</th>
              <th>Quantit√©</th>
              <th>Date mise √† dispo</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody id="preparationsBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section Affaires -->
    <section id="affairesSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="affairesSearchInput" placeholder="Filtre code, libell√©, statut">
        </div>
        <div class="actions">
          <button id="btnAffAdd">Ajouter une affaire</button>
          <button id="btnAffEdit" disabled>Modifier</button>
          <button id="btnAffDelete" disabled>Supprimer</button>
        </div>
      </div>
      <div class="inventory-table-wrapper">
        <table id="affairesTable">
          <thead>
            <tr>
              <th>Code</th>
              <th>Libell√©</th>
              <th>Statut</th>
              </tr>
          </thead>
          <tbody id="affairesBody">
            <!-- Lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

  </main>
<!-- Modale Article -->
  <div class="modal-backdrop" id="articleModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="articleModalTitle">
      <div class="modal-header">
        <h2 id="articleModalTitle">Article</h2>
        <button class="modal-close" id="articleModalClose" aria-label="Fermer">√ó</button>
      </div>

      <form id="articleForm">
        <div class="modal-body">
          <div class="modal-grid">
            <div class="full">
              <label for="f_marque">Marque</label>
              <input type="text" id="f_marque" required>
            </div>

            <div>
              <label for="f_reference">R√©f√©rence</label>
              <input type="text" id="f_reference">
            </div>

            <div>
              <label for="f_unite">Unit√©</label>
              <select id="f_unite">
                <option value="u">u</option>
                <option value="ml">ml</option>
                <option value="kg">kg</option>
              </select>
            </div>

            <div class="full">
              <label for="f_libelle">Libell√©</label>
              <input type="text" id="f_libelle">
            </div>

            <div>
              <label for="f_categorie">Cat√©gorie</label>
              <input type="text" id="f_categorie">
            </div>

            <div>
              <label for="f_allee">All√©e</label>
              <input type="text" id="f_allee">
            </div>

            <div>
              <label for="f_place">Place</label>
              <input type="text" id="f_place">
            </div>

            <div>
              <label for="f_niveau">Niveau</label>
              <input type="text" id="f_niveau">
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="btnModalCancel">Annuler</button>
          <button class="primary" id="btnModalSave" type="submit">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale Utilisateur (admin) -->
  <div class="modal-backdrop" id="userModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="userModalTitle">
      <div class="modal-header">
        <h2 id="userModalTitle">Gestion utilisateur</h2>
        <button class="modal-close" id="userModalClose" aria-label="Fermer">√ó</button>
      </div>

      <form id="userForm">
        <div class="modal-body">
          <div class="modal-grid">
            <div class="full">
              <label for="u_name">Identifiant</label>
              <input type="text" id="u_name" required>
            </div>
            <div>
              <label for="u_role">R√¥le</label>
              <select id="u_role">
                <option value="defaut">defaut</option>
                <option value="admin">admin</option>
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="btnUserCancel">Annuler</button>
          <button class="primary" type="submit">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale Affaire -->
  <div class="modal-backdrop" id="affaireModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="affaireModalTitle">
      <div class="modal-header">
        <h2 id="affaireModalTitle">Affaire</h2>
        <button class="modal-close" id="affaireModalClose" aria-label="Fermer">√ó</button>
      </div>

      <form id="affaireForm">
        <div class="modal-body">
          <div class="modal-grid">
            <div>
              <label for="a_code">Code affaire</label>
              <input type="text" id="a_code" required>
            </div>
            <div class="full">
              <label for="a_libelle">Libell√©</label>
              <input type="text" id="a_libelle">
            </div>
            <div>
              <label for="a_statut">Statut</label>
              <select id="a_statut">
                <option value="ouvert">ouvert</option>
                <option value="clos">clos</option>
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="btnAffCancel">Annuler</button>
          <button class="primary" type="submit">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale Modifier mot de passe -->
  <div class="modal-backdrop" id="pwdModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="pwdModalTitle">
      <div class="modal-header">
        <h2 id="pwdModalTitle">Modifier mon mot de passe</h2>
        <button class="modal-close" id="pwdModalClose" aria-label="Fermer">√ó</button>
      </div>

      <form id="pwdForm">
        <div class="modal-body">
          <div class="modal-grid">
            <div class="full">
              <label for="pwd_old">Mot de passe actuel</label>
              <input type="password" id="pwd_old" required>
            </div>
            <div class="full">
              <label for="pwd_new">Nouveau mot de passe</label>
              <input type="password" id="pwd_new" required>
            </div>
            <div class="full">
              <label for="pwd_confirm">Confirmer le nouveau mot de passe</label>
              <input type="password" id="pwd_confirm" required>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="btnPwdCancel">Annuler</button>
          <button class="primary" type="submit">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale Mouvement -->
  <div class="modal-backdrop" id="mouvModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mouvModalTitle">
      <div class="modal-header">
        <h2 id="mouvModalTitle">Cr√©er un mouvement</h2>
        <button class="modal-close" id="mouvModalClose" aria-label="Fermer">√ó</button>
      </div>

      <form id="mouvForm">
        <div class="modal-body">
          <div class="modal-grid">
            <div>
              <label for="m_sens">Sens</label>
              <select id="m_sens">
                <option value="entree">Entr√©e</option>
                <option value="sortie">Sortie</option>
              </select>
            </div>

            <div class="full">
              <label for="m_article">Article</label>
              <select id="m_article" required></select>
            </div>

            <div>
              <label for="m_quantite">Quantit√©</label>
              <input type="number" id="m_quantite" min="0.01" step="0.01" required>
            </div>

            <div id="m_prix_group">
              <label for="m_prix">Prix unitaire</label>
              <input type="number" id="m_prix" min="0" step="0.01">
            </div>

            <div class="full" id="m_affaire_group" style="display:none;">
              <label for="m_affaire">Code affaire</label>
              <select id="m_affaire">
                <!-- options affaires -->
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="btnMouvCancel">Annuler</button>
          <button class="primary" type="submit">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modale Panier / R√©servation -->
  <div class="modal-backdrop" id="panierModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="panierModalTitle">
      <div class="modal-header">
        <h2 id="panierModalTitle">Nouvelle r√©servation</h2>
        <button class="modal-close" id="panierModalClose" aria-label="Fermer">√ó</button>
      </div>

      <form id="panierForm">
        <div class="modal-body">
          <div class="modal-grid">
            <div class="full">
              <label for="p_affaire">Affaire</label>
              <select id="p_affaire" required></select>
            </div>
            <div class="full">
              <label for="p_date">Date mise √† disposition</label>
              <input type="date" id="p_date" required>
            </div>
          </div>

          <div style="margin-top:16px;">
            <button type="button" id="btnPanierAddLine">Ajouter un article</button>
          </div>

          <div class="inventory-table-wrapper" style="margin-top:8px;">
            <table id="panierTable">
              <thead>
                <tr>
                  <th>Article</th>
                  <th>Quantit√©</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="panierBody">
                <!-- lignes panier -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="modal-footer">
          <button id="btnPanierCancel" type="button">Annuler</button>
          <button class="primary" id="btnPanierValidate" type="submit">Valider le panier</button>
        </div>
      </form>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.20.0/xlsx.full.min.js"></script>
  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/article.js"></script>
  <script type="module" src="js/settings.js"></script>
  <script type="module" src="js/mouvements.js"></script>
  <script type="module" src="js/reservations.js"></script>
  <script type="module" src="js/preparations.js"></script>
  <script type="module" src="js/affaires.js"></script>

  <!-- Gestion centralis√©e des onglets -->
  <script>
    const articlesSection = document.getElementById("articlesSection");
    const mouvementsSection = document.getElementById("mouvementsSection");
    const reservationsSection = document.getElementById("reservationsSection");
    const preparationsSection = document.getElementById("preparationsSection");
    const affairesSection = document.getElementById("affairesSection");

    const tabArticles = document.getElementById("tab-articles");
    const tabMouvements = document.getElementById("tab-mouvements");
    const tabReservations = document.getElementById("tab-reservations");
    const tabPreparations = document.getElementById("tab-preparations");
    const tabAffaires = document.getElementById("tab-affaires");

    function showOnly(section) {
      articlesSection.style.display     = section === "articles"     ? "block" : "none";
      mouvementsSection.style.display   = section === "mouvements"   ? "block" : "none";
      reservationsSection.style.display = section === "reservations" ? "block" : "none";
      preparationsSection.style.display = section === "preparations" ? "block" : "none";
      affairesSection.style.display     = section === "affaires"     ? "block" : "none";
    }

    function activateTab(tab) {
      [tabArticles, tabMouvements, tabReservations, tabPreparations, tabAffaires].forEach(t => {
        if (!t) return;
        t.classList.toggle("active", t === tab);
      });
    }

    tabArticles.addEventListener("click", () => {
      showOnly("articles");
      activateTab(tabArticles);
    });

    tabMouvements.addEventListener("click", () => {
      showOnly("mouvements");
      activateTab(tabMouvements);
    });

    tabReservations.addEventListener("click", () => {
      showOnly("reservations");
      activateTab(tabReservations);
    });

    tabPreparations.addEventListener("click", () => {
      showOnly("preparations");
      activateTab(tabPreparations);
    });

    tabAffaires.addEventListener("click", () => {
      showOnly("affaires");
      activateTab(tabAffaires);
      if (window.affairesModule && window.affairesModule.chargerAffaires) {
        window.affairesModule.chargerAffaires();
      }
    });
  </script>

</body>
</html>








