<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inventaire magasin</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- jsPDF pour les bons d'achat -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- html2pdf pour les bons de pr√©paration -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <header class="app-header">
    <div class="header-left">
      <h1>Gestion de stock</h1>
      <span id="currentUser"></span>

      <div class="tabs">
        <button class="tab active" id="tab-articles">Articles</button>
        <button class="tab" id="tab-mouvements">Mouvements</button>
        <button class="tab" id="tab-reservations">R√©servations</button>
        <button class="tab" id="tab-preparations">Pr√©parations</button>
        <button class="tab" id="tab-affaires">Affaires</button>
      </div>
    </div>
    <div class="header-right">
      <div id="datetime"></div>

      <div class="user-menu">
        <button class="user-menu-toggle" id="userMenuToggle">
          <span id="userRoleLabel" class="role"></span>
          <span class="chevron">‚ñæ</span>
        </button>
        <div class="user-menu-dropdown" id="userMenuDropdown">
          <!-- Contenu rempli en JS selon r√¥le -->
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- Section Articles -->
    <section id="articlesSection">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="searchInput"
                 placeholder="Recherche (marque, r√©f, libell√©, cat√©gorie, emplacement)‚Ä¶">
        </div>

        <div class="actions">
          <button id="btnAdd">Ajouter un article</button>
          <button id="btnEdit" disabled>Modifier</button>
          <button id="btnDelete" disabled>Supprimer</button>
        </div>
      </div>

      <div class="stock-footer">
        Valeur totale du stock : <span id="valeurStockTotal"></span>
        <button id="btnPrintStock" class="secondary" style="margin-left:12px; display:none;">
            Imprimer le stock
        </button>
      </div>

      <div class="inventory-table-wrapper">
        <table id="articlesTable">
          <thead>
            <tr>
              <th>Marque</th>
              <th>R√©f√©rence</th>
              <th>Libell√©</th>
              <th>Unit√©</th>
              <th>Cat√©gorie</th>
              <th>Emplacement</th>
              <th>Stock</th>
              <th>Stock dispo</th>
              <th>CUMP</th>
              <th>Valeur stock</th>
            </tr>
          </thead>
          <tbody id="articlesBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section Mouvements -->
    <section id="mouvementsSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="mouvSearchInput"
                 placeholder="Filtre (article, sens, affaire)‚Ä¶">
        </div>
        <div class="actions">
          <button id="btnMouvAdd">Cr√©er un mouvement</button>
        </div>
      </div>

      <div class="inventory-table-wrapper">
        <table id="mouvementsTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Sens</th>
              <th>Article</th>
              <th>Quantit√©</th>
              <th>Prix unitaire</th>
              <th>Code affaire</th>
            </tr>
          </thead>
          <tbody id="mouvementsBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section R√©servations -->
    <section id="reservationsSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="reservSearchInput"
                 placeholder="Filtre (affaire, article)‚Ä¶">
        </div>
        <div class="actions">
          <button id="btnNewReservation">Nouvelle r√©servation</button>
        </div>
      </div>

      <div class="inventory-table-wrapper">
        <table id="reservationsTable">
          <thead>
            <tr>
              <th>Affaire</th>
              <th>Article</th>
              <th>Quantit√©</th>
              <th>Date mise √† dispo</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody id="reservationsBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section Pr√©parations -->
    <section id="preparationsSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div>
          <label for="prepDateDebut">Du</label>
          <input type="date" id="prepDateDebut">
          <label for="prepDateFin">au</label>
          <input type="date" id="prepDateFin">
          <button id="btnPrepFiltrer">Filtrer</button>
        </div>
        <div class="actions">
          <button id="btnPrintPreparations">üñ®Ô∏è Imprimer les bons</button>
          <button id="btnValiderPreparation" disabled>‚úÖ Valider la pr√©paration</button>
        </div>
      </div>

      <div class="inventory-table-wrapper">
        <table id="preparationsTable">
          <thead>
            <tr>
              <th>Affaire</th>
              <th>Article</th>
              <th>Quantit√©</th>
              <th>Date mise √† dispo</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody id="preparationsBody">
            <!-- lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section Affaires -->
    <section id="affairesSection" style="display:none; margin-top:16px;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="affairesSearchInput" placeholder="Filtre code, libell√©, statut">
        </div>
        <div class="actions">
          <!-- Boutons admin seulement, g√©r√©s en JS -->
        </div>
      </div>
      <div class="inventory-table-wrapper">
        <table id="affairesTable">
          <thead>
            <tr>
              <th>Code</th>
              <th>Libell√©</th>
              <th>Statut</th>
              <th>Date cr√©ation</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="affairesBody">
            <!-- Lignes g√©n√©r√©es en JS -->
          </tbody>
        </table>
      </div>
    </section>

  </main>

  <!-- Modales (inchang√©es) -->
  <!-- ... tout le bloc de modales que tu as d√©j√†, inchang√© ... -->

  <!-- (Je ne recopie pas toutes les modales ici pour ne pas faire un pav√©,
       tu gardes exactement tes blocs Modale Article / Utilisateur / Affaire /
       Mot de passe / Mouvement / Panier tels qu'ils sont d√©j√† dans ton fichier.) -->

  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/article.js"></script>
  <script type="module" src="js/settings.js"></script>
  <script type="module" src="js/mouvements.js"></script>
  <script type="module" src="js/reservations.js"></script>
  <script type="module" src="js/preparations.js"></script>
  <script type="module" src="js/affaires.js"></script>

  <!-- Gestion centralis√©e des onglets -->
  <script>
    const articlesSection = document.getElementById("articlesSection");
    const mouvementsSection = document.getElementById("mouvementsSection");
    const reservationsSection = document.getElementById("reservationsSection");
    const preparationsSection = document.getElementById("preparationsSection");
    const affairesSection = document.getElementById("affairesSection");

    const tabArticles = document.getElementById("tab-articles");
    const tabMouvements = document.getElementById("tab-mouvements");
    const tabReservations = document.getElementById("tab-reservations");
    const tabPreparations = document.getElementById("tab-preparations");
    const tabAffaires = document.getElementById("tab-affaires");

    function showOnly(section) {
      articlesSection.style.display     = section === "articles"     ? "block" : "none";
      mouvementsSection.style.display   = section === "mouvements"   ? "block" : "none";
      reservationsSection.style.display = section === "reservations" ? "block" : "none";
      preparationsSection.style.display = section === "preparations" ? "block" : "none";
      affairesSection.style.display     = section === "affaires"     ? "block" : "none";
    }

    function activateTab(tab) {
      [tabArticles, tabMouvements, tabReservations, tabPreparations, tabAffaires].forEach(t => {
        if (!t) return;
        t.classList.toggle("active", t === tab);
      });
    }

    tabArticles.addEventListener("click", () => {
      showOnly("articles");
      activateTab(tabArticles);
    });

    tabMouvements.addEventListener("click", () => {
      showOnly("mouvements");
      activateTab(tabMouvements);
    });

    tabReservations.addEventListener("click", () => {
      showOnly("reservations");
      activateTab(tabReservations);
    });

    tabPreparations.addEventListener("click", () => {
      showOnly("preparations");
      activateTab(tabPreparations);
    });

    tabAffaires.addEventListener("click", () => {
      showOnly("affaires");
      activateTab(tabAffaires);
      if (window.affairesModule && window.affairesModule.chargerAffaires) {
        window.affairesModule.chargerAffaires();
      }
    });
  </script>

</body>
</html>
